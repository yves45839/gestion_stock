{% extends "inventory/base.html" %}
{% block title %}Import CSV{% endblock %}
{% block content %}
<section class="surface reveal" style="max-width:900px; margin:0 auto;">
    <div class="surface-header">
        <div>
            <p class="eyebrow">Catalogue</p>
            <h1 class="surface-title">Import CSV produits</h1>
            <p class="muted-text" style="margin:0;">Alimentez le catalogue depuis un fichier exporté.</p>
        </div>
        <a href="{% url 'inventory:inventory_overview' %}" class="btn secondary">Retour</a>
    </div>
    <p class="muted-text">
        Le modèle CSV accepte toutes les colonnes du produit : <strong>SKU</strong>, <strong>Ref</strong>, <strong>Désignation</strong>, <strong>Description</strong>, <strong>Marque</strong>, <strong>Catégorie</strong>, <strong>Code-barres</strong>, <strong>Stock minimal</strong>, <strong>Prix achat</strong>, <strong>Prix vente</strong>, <strong>Qté</strong> et <strong>Unité</strong>. Le séparateur peut être « ; » ou « , ».
    </p>
    {% if active_site %}
        <p class="muted-text" style="margin-top:0.25rem;">
            Importation liée au site actif <strong>{{ active_site.name }}</strong>.
            {% if can_switch_site %}Utilisez le champ ci-dessous pour changer de site avant d'importer.{% endif %}
        </p>
    {% else %}
        <p class="muted-text" style="margin-top:0.25rem;">Aucune vue de site forcée : le site par défaut sera utilisé pour l'importation.</p>
    {% endif %}
    <p><a class="btn secondary" href="{% url 'inventory:export_import_template' %}">Télécharger le modèle CSV</a></p>
<form method="post" enctype="multipart/form-data" class="form-grid reveal" data-delay="140">
        {% csrf_token %}
        <div class="field">
            <label for="{{ form.file.id_for_label }}">{{ form.file.label }}</label>
            {{ form.file }}
            {{ form.file.errors }}
        </div>
        <div class="field">
            <label for="{{ form.encoding.id_for_label }}">{{ form.encoding.label }}</label>
            {{ form.encoding }}
        </div>
        <div class="field" style="grid-column:1 / -1;">
            <label>{{ form.apply_quantity }} {{ form.apply_quantity.label }}</label>
        </div>
        <div class="field">
            <label for="{{ form.movement_type.id_for_label }}">{{ form.movement_type.label }}</label>
            {{ form.movement_type }}
            <small class="muted-text">{{ form.movement_type.help_text }}</small>
        </div>
        {% if form.site.is_hidden %}
            {{ form.site }}
            {{ form.site.errors }}
        {% else %}
            <div class="field">
                <label for="{{ form.site.id_for_label }}">{{ form.site.label }}</label>
                {{ form.site }}
                {{ form.site.errors }}
                <small class="muted-text">{{ form.site.help_text }}</small>
            </div>
        {% endif %}
        <div style="grid-column:1 / -1;">
            <button type="submit" class="btn">Lancer l'import</button>
        </div>
    </form>
</section>
{% if report %}
    <section class="surface reveal" data-delay="200" style="max-width:900px; margin:1.5rem auto 0;">
        <h3 class="surface-title">Résumé</h3>
        <p>{{ report.created }} produits créés — {{ report.updated }} mis à jour — {{ report.movements }} mouvements enregistrés.</p>
        {% if report.errors %}
            <h4 style="margin-bottom:0.5rem;">Lignes ignorées</h4>
            <ul>
                {% for error in report.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </section>
{% endif %}
{% endblock %}
